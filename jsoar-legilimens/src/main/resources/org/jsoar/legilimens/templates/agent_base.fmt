<#include "/base.fmt"/>

<#global agent_url="${agents_url}/${agent.name?url}"/>
<#global commands_url="${agent_url}/commands"/>
<#global productions_url="${agent_url}/productions"/>
<#global trace_url="${agent_url}/trace"/>
<#global properties_url="${agent_url}/properties"/>
<#global wmes_url="${agent_url}/wmes"/>

<#global title>Agent - ${agent?html}</#global>

<#macro production_link p>
<a href="${productions_url}/${p.name?url}">${p.name?html}</a>
</#macro>

<#macro production_edit_link p>
<a href="${productions_url}/${p.name?url}/edit">[edit]</a>
</#macro>

<#global agent_links>
<ul>
    <li<#if resource.name=="agents"> class="selected"</#if>><a href="${agents_url}">All Agents</a>
    <li<#if resource.name=="agent"> class="selected"</#if>><a href="${agent_url}">${agent?html}</a>
    <li<#if resource.name=="productions"> class="selected"</#if>><a href="${productions_url}">${agent.productions.productionCount} productions</a>
    <li<#if resource.name=="trace"> class="selected"</#if>><a href="${trace_url}">Trace</a>
    <li<#if resource.name=="properties"> class="selected"</#if>><a href="${properties_url}">Properties</a>
    <li<#if resource.name=="wmes"> class="selected"</#if>>Working Memory - <a href="${wmes_url}">All</a> 
                       - <a href="${wmes_url}?id=S1">S1</a>
                       - <a href="${wmes_url}?id=I2">I2</a>
                       - <a href="${wmes_url}?id=S3">I3</a>
</ul>
</#global>

<#global command_entry>
    <form id="agent_command_form" action="">
        Command: <input id="agent_command_string" type="text" name="command" value=""/>
        <input id="agent_command_submit" type="submit" NAME="name" value="Execute"/>
    </form>
</#global>

<#macro agent_command_link function name>
<a href="javascript:Legilimens.${function}();">${name?html}</a>
</#macro>

<#global agent_controls>
<div id="agent_controls">
    ${command_entry}
    <ul>
        <li><@agent_command_link function="run" name="run"/>
        <li><@agent_command_link function="step" name="step"/>
        <li><@agent_command_link function="stop" name="stop"/>
        <li><@agent_command_link function="initSoar" name="init-soar"/>
    </ul>
</div>
</#global>

<#global header>
<h1>${agent?html}</h1>
${agent_links}
${agent_controls}
</#global>

<#global extra_scripts>
    ${extra_scripts!""}
    <script type="text/javascript">
        Legilimens.agent_url="${agent_url?js_string}";
        Legilimens.commands_url="${commands_url?js_string}";
    </script>
</#global>

<#global footer>
${footer!""}

<script type="text/javascript">
$(function() {
    $("#agent_command_submit").click(function() {
        var command = $("input#agent_command_string").val();
        Legilimens.runAgentCommand(command);
        return false;
    })
});
</script>

</#global>

